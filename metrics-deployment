kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml


kubectl -n kube-system get deployment metrics-server -o yaml


kubectl patch deployment metrics-server -n kube-system --type='json' -p='[
{
"op": "add",
"path": "/spec/template/spec/hostNetwork",
"value": true
},
{
"op": "replace",
"path": "/spec/template/spec/containers/0/args",
"value": [
"--cert-dir=/tmp",
"--secure-port=4443",
"--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname",
"--kubelet-use-node-status-port",
"--metric-resolution=15s",
"--kubelet-insecure-tls"
]
},
{
"op": "replace",
"path": "/spec/template/spec/containers/0/ports/0/containerPort",
"value": 4443
}
]'

kubectl -n kube-system get pods -l k8s-app=metrics-server

kubectl get apiservices -l k8s-app=metrics-server

kubectl top nodes





#####################################################################################################################################

METRICS DASHBOARD

Step 1: Deploy Kubernetes Dashboard
kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml


Verify:

kubectl get pods -n kubernetes-dashboard

Step 2: Create admin user (for now)
kubectl apply -f - <<EOF
apiVersion: v1
kind: ServiceAccount
metadata:
  name: dashboard-admin
  namespace: kubernetes-dashboard
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: dashboard-admin
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: dashboard-admin
  namespace: kubernetes-dashboard
EOF


Get login token:

kubectl -n kubernetes-dashboard create token dashboard-admin

Step 3: Expose Dashboard securely (HTTPS)
Option A: Local secure access (recommended initially)
kubectl proxy


Access:

https://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/


✔ HTTPS
✔ No public exposure
✔ Safest option

Option B: HTTPS via NodePort (your use case)

Edit the service:

kubectl -n kubernetes-dashboard edit svc kubernetes-dashboard


Change:

type: ClusterIP


to:

type: NodePort


Check port:

kubectl -n kubernetes-dashboard get svc kubernetes-dashboard


Example:

443:32001/TCP


Access:

https://<NODE_IP>:32001

Option C: HTTPS via your AWS NGINX + domain (BEST for you)

You already have:

AWS EC2 with NGINX

Domain

HTTPS certs

Add this to NGINX:

server {
    listen 443 ssl;
    server_name k8s.example.com;

    ssl_certificate     /home/ubuntu/cert/fullchain.pem;
    ssl_certificate_key /home/ubuntu/cert/privkey.pem;

    location / {
        proxy_pass https://192.168.1.181:32001;
        proxy_ssl_verify off;

        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-Proto https;
    }
}


Now access:

https://k8s.example.com


✔ HTTPS
✔ Domain-based
✔ No AWS LB

kubectl top pods
